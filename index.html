<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dune Awakening - Rastreador de Inventario</title>
    <style>

    .item-actions .crafting-status {
    font-size: 0.85rem;
    margin-right: auto;
    padding-left: 0.5rem;
    color: #00ffcc;
}

        /* Reset y configuraci√≥n base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0f1c 0%, #1a2332 50%, #2d3748 100%);
            color: #e2e8f0;
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Header */
        .header {
            display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
            
            background: linear-gradient(135deg, rgba(20, 30, 48, 0.95) 0%, rgba(45, 66, 99, 0.9) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 3px solid #ffa726;
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .header-content h1 {
            color: #ffa726;
            font-size: 2.2rem;
            font-weight: bold;
            text-shadow: 0 2px 8px rgba(255, 167, 38, 0.4);
            margin-bottom: 0.5rem;
        }

        .header-content p {
            color: #cbd5e0;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .search-container {
            position: relative;
            margin: 1rem 0;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 3rem 0.75rem 1rem;
            background: rgba(45, 66, 99, 0.3);
            border: 2px solid #4a5568;
            border-radius: 10px;
            color: #e2e8f0;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #ffa726;
            background: rgba(45, 66, 99, 0.5);
            box-shadow: 0 0 15px rgba(255, 167, 38, 0.2);
        }

        .clear-btn {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #a0aec0;
            cursor: pointer;
            font-size: 1.2rem;
            transition: color 0.3s ease;
        }

        .clear-btn:hover {
            color: #ffa726;
        }

        .utility-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .utility-btn {
            background: linear-gradient(135deg, #2d4263 0%, #3d5a80 100%);
            border: 2px solid #4a5568;
            color: #e2e8f0;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .utility-btn:hover {
            background: linear-gradient(135deg, #3d5a80 0%, #4a5568 100%);
            border-color: #ffa726;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 167, 38, 0.2);
        }

        /* Navegaci√≥n de pesta√±as */
        .nav-tabs {
            display: flex;
            background: rgba(20, 30, 48, 0.8);
            border-bottom: 2px solid #4a5568;
            overflow-x: auto;
            padding: 0 2rem;
        }

        .tab-btn {
            background: transparent;
            border: none;
            color: #a0aec0;
            padding: 1.2rem 2rem;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab-btn:hover {
            color: #e2e8f0;
            background: rgba(45, 66, 99, 0.3);
        }

        .tab-btn.active {
            color: #ffa726;
            border-bottom-color: #ffa726;
            background: rgba(255, 167, 38, 0.1);
        }

        /* Contenido principal */
        .main-content {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .tab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .tab-header h2 {
            color: #ffa726;
            font-size: 1.8rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .add-btn {
            background: linear-gradient(135deg, #38a169 0%, #48bb78 100%);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(56, 161, 105, 0.3);
        }

        .add-btn:hover {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(56, 161, 105, 0.4);
        }

        /* Filtros */
        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .filter-select {
            background: rgba(45, 66, 99, 0.3);
            border: 2px solid #4a5568;
            color: #e2e8f0;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .filter-select:focus {
            outline: none;
            border-color: #ffa726;
            background: rgba(45, 66, 99, 0.5);
        }

        /* Contenedor de items */
        .items-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        /* Tarjetas de items */
        .item-card {
            background: linear-gradient(135deg, rgba(45, 66, 99, 0.4) 0%, rgba(74, 85, 104, 0.3) 100%);
            border: 2px solid #4a5568;
            border-radius: 15px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .item-card:hover {
            border-color: #ffa726;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 167, 38, 0.2);
        }

        .item-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ffa726, #ff8f00);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .item-card:hover::before {
            opacity: 1;
        }

        .item-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .item-image {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            object-fit: cover;
            border: 2px solid #4a5568;
            background: rgba(74, 85, 104, 0.3);
        }

        .item-info h3 {
            color: #e2e8f0;
            font-size: 1.2rem;
            margin-bottom: 0.25rem;
        }

        .item-category {
            color: #ffa726;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .item-level {
            background: rgba(255, 167, 38, 0.2);
            color: #ffa726;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: auto;
        }

        .item-quantity {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
            padding: 0.75rem;
            background: rgba(20, 30, 48, 0.5);
            border-radius: 10px;
        }

        .quantity-label {
            color: #a0aec0;
            font-weight: 500;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-left: auto;
        }

        .quantity-btn {
            background: #4a5568;
            border: none;
            color: #e2e8f0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .quantity-btn:hover {
            background: #ffa726;
            transform: scale(1.1);
        }

        .quantity-display {
            color: #ffa726;
            font-weight: bold;
            font-size: 1.1rem;
            min-width: 40px;
            text-align: center;
        }

        .item-notes {
            color: #cbd5e0;
            font-size: 0.9rem;
            font-style: italic;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #4a5568;
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
            margin-top: 1rem;
        }

        .edit-btn, .delete-btn {
            background: none;
            border: 2px solid #4a5568;
            color: #a0aec0;
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .edit-btn:hover {
            border-color: #4299e1;
            color: #4299e1;
        }

        .delete-btn:hover {
            border-color: #f56565;
            color: #f56565;
        }

        /* Tarjetas espec√≠ficas para objetos/veh√≠culos/armas */
        .crafting-card {
            position: relative;
        }

        .crafting-status {
            position: absolute;
            bottom: 1.5rem;
            left: 1.6rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .can-craft {
            background: rgba(56, 161, 105, 0.3);
            color: #48bb78;
            border: 1px solid #48bb78;
        }

        .missing-materials {
            background: rgba(245, 101, 101, 0.3);
            color: #f56565;
            border: 1px solid #f56565;
        }

        .recipe-info {
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(20, 30, 48, 0.5);
            border-radius: 10px;
        }

        .recipe-title {
            color: #ffa726;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .recipe-materials {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .material-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(74, 85, 104, 0.3);
        }

        .material-item:last-child {
            border-bottom: none;
        }

        .material-name {
            color: #e2e8f0;
        }

        .material-available {
            color: #48bb78;
            font-weight: 500;
        }

        .material-missing {
            color: #f56565;
            font-weight: 500;
        }

        .craft-info {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #4a5568;
            font-size: 0.9rem;
            color: #a0aec0;
        }

        /* Modales */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            border: 2px solid #4a5568;
            border-radius: 15px;
            padding: 0;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .crafting-modal {
            max-width: 700px;
        }

        .modal-header {
            background: linear-gradient(135deg, #2d4263 0%, #3d5a80 100%);
            padding: 1.5rem 2rem;
            border-bottom: 2px solid #4a5568;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 15px 15px 0 0;
        }

        .modal-header h3 {
            color: #ffa726;
            font-size: 1.4rem;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            color: #a0aec0;
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
            padding: 0.5rem;
            border-radius: 50%;
        }

        .close-btn:hover {
            color: #f56565;
            background: rgba(245, 101, 101, 0.1);
        }

        .modal form {
            padding: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            color: #e2e8f0;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(45, 66, 99, 0.3);
            border: 2px solid #4a5568;
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ffa726;
            background: rgba(45, 66, 99, 0.5);
            box-shadow: 0 0 10px rgba(255, 167, 38, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #4a5568;
        }

        .submit-btn {
            background: linear-gradient(135deg, #38a169 0%, #48bb78 100%);
            border: none;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(56, 161, 105, 0.3);
        }

        .cancel-btn {
            background: rgba(74, 85, 104, 0.3);
            border: 2px solid #4a5568;
            color: #a0aec0;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .cancel-btn:hover {
            border-color: #a0aec0;
            color: #e2e8f0;
        }

        /* Receta */
        #recipeContainer {
            border: 2px dashed #4a5568;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            min-height: 60px;
        }

        .recipe-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            background: rgba(45, 66, 99, 0.2);
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }

        .recipe-item:last-child {
            margin-bottom: 0;
        }

        .recipe-item select {
            flex: 2;
            margin: 0;
        }

        .recipe-item input {
            flex: 1;
            margin: 0;
        }

        .remove-material {
            background: #f56565;
            border: none;
            color: white;
            padding: 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .remove-material:hover {
            background: #e53e3e;
            transform: scale(0.95);
        }

        .add-material-btn {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            width: 100%;
        }

        .add-material-btn:hover {
            background: linear-gradient(135deg, #3182ce 0%, #2c5282 100%);
            transform: translateY(-1px);
        }

        /* Calculadora */
        .calculator-content {
            padding: 2rem;
        }

        .calculator-results {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(20, 30, 48, 0.5);
            border-radius: 10px;
            border: 2px solid #4a5568;
        }

        .calculator-results h4 {
            color: #ffa726;
            margin-bottom: 1rem;
        }

        .materials-needed {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .needed-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: rgba(45, 66, 99, 0.3);
            border-radius: 8px;
        }

        .needed-sufficient {
            border-left: 4px solid #48bb78;
        }

        .needed-insufficient {
            border-left: 4px solid #f56565;
        }

        /* Objetivos */
        .objectives-content {
            padding: 2rem;
        }

        .objectives-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 1rem;
        }

        .objective-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: rgba(45, 66, 99, 0.3);
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border-left: 4px solid #ffa726;
        }

        .objective-text {
            flex: 1;
            color: #e2e8f0;
        }

        .objective-actions {
            display: flex;
            gap: 0.5rem;
        }

        .complete-btn {
            background: #48bb78;
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .complete-btn:hover {
            background: #38a169;
        }

        .objective-item.completed {
            opacity: 0.6;
            border-left-color: #48bb78;
        }

        .objective-item.completed .objective-text {
            text-decoration: line-through;
            color: #a0aec0;
        }

        /* Estados de carga */
        .loading {
            text-align: center;
            padding: 3rem;
            color: #a0aec0;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #a0aec0;
        }

        .empty-state h3 {
            color: #ffa726;
            margin-bottom: 1rem;
        }

        /* Dashboard Styles */
        .dashboard-summary {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            margin-left: auto;
        }

        .summary-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .summary-number {
            color: #ffa726;
            font-size: 2rem;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(255, 167, 38, 0.3);
        }

        .summary-label {
            color: #a0aec0;
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .dashboard-card {
            background: linear-gradient(135deg, rgba(45, 66, 99, 0.4) 0%, rgba(74, 85, 104, 0.3) 100%);
            border: 2px solid #4a5568;
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            border-color: #ffa726;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 167, 38, 0.15);
        }

        .card-header {
            background: rgba(20, 30, 48, 0.6);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #4a5568;
        }

        .card-header h3 {
            color: #e2e8f0;
            font-size: 1.1rem;
            margin: 0 0 0.25rem 0;
        }

        .card-subtitle {
            color: #a0aec0;
            font-size: 0.8rem;
        }

        .card-content {
            padding: 1.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .dashboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(74, 85, 104, 0.3);
        }

        .dashboard-item:last-child {
            border-bottom: none;
        }

        .dashboard-item-name {
            color: #e2e8f0;
            font-weight: 500;
        }

        .dashboard-item-value {
            color: #ffa726;
            font-weight: 600;
        }

        .dashboard-item-category {
            color: #a0aec0;
            font-size: 0.8rem;
        }

        .warning-item {
            border-left: 3px solid #f56565;
            padding-left: 0.75rem;
        }

        .success-item {
            border-left: 3px solid #48bb78;
            padding-left: 0.75rem;
        }

        .info-item {
            border-left: 3px solid #4299e1;
            padding-left: 0.75rem;
        }

        .objective-preview {
            background: rgba(255, 167, 38, 0.1);
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            border-left: 3px solid #ffa726;
        }

        .objective-preview:last-child {
            margin-bottom: 0;
        }

        .objective-preview-text {
            color: #e2e8f0;
            font-size: 0.9rem;
        }

        .category-stat {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0;
        }

        .category-name {
            color: #e2e8f0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .category-count {
            color: #ffa726;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(74, 85, 104, 0.3);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffa726, #ff8f00);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .empty-dashboard {
            text-align: center;
            padding: 2rem;
            color: #a0aec0;
        }

        .empty-dashboard h4 {
            color: #ffa726;
            margin-bottom: 0.5rem;
        }

        /* Footer */
        .footer {
            background: linear-gradient(135deg, rgba(20, 30, 48, 0.95) 0%, rgba(45, 66, 99, 0.9) 100%);
            border-top: 2px solid #ffa726;
            margin-top: 3rem;
            padding: 2rem;
            text-align: center;
        }

        .footer-content p {
            color: #cbd5e0;
            font-size: 1rem;
            margin: 0;
        }

        .footer-content strong {
            color: #ffa726;
            font-weight: 600;
        }

        /* Responsive Design */

        /* Tablet Samsung Galaxy S9+ Vertical (768px) */
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }
            
            .header-content h1 {
                font-size: 1.8rem;
            }
            
            .utility-buttons {
                justify-content: center;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .items-container {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .tab-header {
                flex-direction: column;
                align-items: stretch;
                text-align: center;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .filter-select {
                min-width: auto;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 1rem;
                max-height: calc(100vh - 2rem);
            }
            
            .form-buttons {
                flex-direction: column;
            }
            
            .nav-tabs {
                padding: 0 1rem;
            }
            
            .tab-btn {
                padding: 1rem 1.5rem;
                font-size: 1rem;
            }

            .dashboard-summary {
                justify-content: center;
                margin-left: 0;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .tab-header {
                flex-direction: column;
                gap: 1rem;
            }
        }

        /* Tablet Horizontal y pantallas medianas (1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .items-container {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
            
            .utility-buttons {
                justify-content: flex-start;
            }
        }

        /* Pantallas grandes (PC 17") */
        @media (min-width: 1200px) {
            .items-container {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            }
            
            .main-content {
                padding: 2.5rem;
            }
            
            .modal-content {
                max-width: 700px;
            }
            
            .crafting-modal {
                max-width: 800px;
            }
        }

        /* Pantallas muy grandes */
        @media (min-width: 1400px) {
            .items-container {
                grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            }
        }

        /* Mejoras para touch en tablets */
        @media (pointer: coarse) {
            .quantity-btn {
                width: 40px;
                height: 40px;
            }
            
            .edit-btn, .delete-btn {
                width: 45px;
                height: 45px;
            }
            
            .tab-btn {
                padding: 1.2rem 2rem;
            }
            
            .add-btn {
                padding: 1rem 2rem;
                font-size: 1.1rem;
            }
        }

        /* Animaciones */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .item-card {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .modal.show .modal-content {
            animation: slideIn 0.3s ease-out;
        }

        /* Scrollbar personalizado */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(74, 85, 104, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #ffa726;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #ff8f00;
        }

        .auth-buttons {
    display: flex;
    gap: 0.5rem;
    align-items: center;
    margin-left: auto;
    flex-wrap: nowrap;
    white-space: nowrap;
}

    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
  <!-- Secci√≥n izquierda: t√≠tulo + subt√≠tulo + buscador -->
  <div style="width: 100%; max-width: 100%;">
    <h1>üèúÔ∏è DUNE AWAKENING</h1>
    <p>Rastreador de Inventario</p>

    <!-- B√∫squeda debajo -->
    <div class="search-container" style="margin-top: 0.75rem; display: flex; gap: 0.25rem; align-items: center; max-width: 400px;">
      <input type="text" id="globalSearch" placeholder="Buscar items..." class="search-input" style="flex: 1;">
      <button id="clearSearch" class="clear-btn">‚úï</button>
    </div>
  </div>

  <!-- Secci√≥n derecha: botones de utilidad -->
  <div class="header-buttons" style="margin-top: 1rem; display: flex; align-items: center; flex-wrap: wrap; gap: 1rem;">
  
  <!-- Botones de utilidad -->
  <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
    <button id="exportBtn" class="utility-btn">üìä Exportar</button>
    <button id="importBtn" class="utility-btn">üì• Importar</button>
    <button id="calculatorBtn" class="utility-btn">üßÆ Calculadora</button>
    <button id="objectivesBtn" class="utility-btn">üéØ Objetivos</button>
    <input type="file" id="importFile" accept=".json" style="display: none;">
  </div>

  <!-- Botones de sesi√≥n -->
  <div style="display: flex; gap: 0.5rem; align-items: center;">
    <button id="loginBtn" class="utility-btn">üîê Iniciar sesi√≥n</button>
    <button id="logoutBtn" class="utility-btn" style="display: none;">üîì Cerrar sesi√≥n</button>
  </div>

  <!-- Nombre de usuario a la derecha -->
  <div id="userNameContainer" style="margin-left: auto; color: #fff; font-size: 0.9rem;">
    <span id="userName"></span>
  </div>

</div>

</header>


    <!-- Navegaci√≥n de Pesta√±as -->
    <nav class="nav-tabs">
        <button class="tab-btn active" data-tab="dashboard">üìä Dashboard</button>
        <button class="tab-btn" data-tab="raw">üóø Recursos en bruto</button>
        <button class="tab-btn" data-tab="refined">‚öóÔ∏è Recursos refinados</button>
        <button class="tab-btn" data-tab="objects">üîß Objetos</button>
        <button class="tab-btn" data-tab="vehicles">üöó Veh√≠culos</button>
        <button class="tab-btn" data-tab="weapons">‚öîÔ∏è Armas</button>
        <button class="tab-btn" data-tab="webs">üåê Webs</button>
        <button class="tab-btn" data-tab="mapa">üó∫Ô∏è Mapa</button>


    </nav>

    <!-- Contenido Principal -->
    <main class="main-content">
        
        <!-- Pesta√±a Dashboard -->
        <section id="dashboard-tab" class="tab-content active">
            <div class="tab-header">
                <h2>üìä Dashboard</h2>
                <div class="dashboard-summary">
                    <div class="summary-item">
                        <span class="summary-number" id="totalItems">0</span>
                        <span class="summary-label">Total Items</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-number" id="totalObjectives">0</span>
                        <span class="summary-label">Objetivos</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-number" id="craftableItems">0</span>
                        <span class="summary-label">Puedo Crear</span>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-grid">
                <!-- Recursos Escasos -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>‚ö†Ô∏è Recursos Escasos</h3>
                        <span class="card-subtitle">Cantidad < 10</span>
                    </div>
                    <div class="card-content" id="lowResourcesContent">
                        <!-- Se llena din√°micamente -->
                    </div>
                </div>
                
                <!-- Items Creables -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>üîß Puedes Crear</h3>
                        <span class="card-subtitle">Materiales disponibles</span>
                    </div>
                    <div class="card-content" id="craftableItemsContent">
                        <!-- Se llena din√°micamente -->
                    </div>
                </div>
                
                <!-- Objetivos Pendientes -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>üéØ Objetivos Pendientes</h3>
                        <span class="card-subtitle">Por completar</span>
                    </div>
                    <div class="card-content" id="pendingObjectivesContent">
                        <!-- Se llena din√°micamente -->
                    </div>
                </div>
                
                <!-- Estad√≠sticas por Categor√≠a -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>üìà Por Categor√≠as</h3>
                        <span class="card-subtitle">Distribuci√≥n de recursos</span>
                    </div>
                    <div class="card-content" id="categoryStatsContent">
                        <!-- Se llena din√°micamente -->
                    </div>
                </div>
                
                <!-- Top 5 Recursos -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>ü•á Top 5 Recursos</h3>
                        <span class="card-subtitle">M√°s abundantes</span>
                    </div>
                    <div class="card-content" id="topResourcesContent">
                        <!-- Se llena din√°micamente -->
                    </div>
                </div>
                
                <!-- Estado del Inventario -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>‚è∞ Estado del Inventario</h3>
                        <span class="card-subtitle">Resumen general</span>
                    </div>
                    <div class="card-content" id="inventoryStatusContent">
                        <!-- Se llena din√°micamente -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Pesta√±a Recursos en bruto -->
        <section id="raw-tab" class="tab-content">
            <div class="tab-header">
                <h2>üóø Recursos en bruto</h2>
                <button class="add-btn" id="addRawBtn">+ A√±adir Recurso</button>
            </div>
            
            <!-- Filtros -->
            <div class="filters">
                <select id="rawCategoryFilter" class="filter-select">
                    <option value="">Todas las categor√≠as</option>
                    <option value="Minerales">Minerales</option>
                    <option value="Metales">Metales</option>
                    <option value="Org√°nicos">Org√°nicos</option>
                    <option value="Combustibles">Combustibles</option>
                    <option value="Otros">Otros</option>
                </select>
                <select id="rawLevelFilter" class="filter-select">
                    <option value="">Todos los tiers</option>
                    <option value="0">Tier 0</option>
                    <option value="1">Tier 1</option>
                    <option value="2">Tier 2</option>
                </select>
            </div>

            <div id="rawContainer" class="items-container">
                <!-- Items se cargan din√°micamente -->
            </div>
        </section>

        <!-- Pesta√±a Recursos refinados -->
        <section id="refined-tab" class="tab-content">
            <div class="tab-header">
                <h2>‚öóÔ∏è Recursos refinados</h2>
                <button class="add-btn" id="addRefinedBtn">+ A√±adir Recurso</button>
            </div>
            
            <!-- Filtros -->
            <div class="filters">
                <select id="refinedCategoryFilter" class="filter-select">
                    <option value="">Todas las categor√≠as</option>
                    <option value="Lingotes">Lingotes</option>
                    <option value="Combustibles">Combustibles</option>
                    <option value="Componentes">Componentes</option>
                    <option value="Otros">Otros</option>
                </select>
                <select id="refinedLevelFilter" class="filter-select">
                    <option value="">Todos los tiers</option>
                    <option value="0">Tier 0</option>
                    <option value="1">Tier 1</option>
                    <option value="2">Tier 2</option>
                </select>
            </div>

            <div id="refinedContainer" class="items-container">
                <!-- Items se cargan din√°micamente -->
            </div>
        </section>

        <!-- Pesta√±a Objetos -->
        <section id="objects-tab" class="tab-content">
            <div class="tab-header">
                <h2>üîß Objetos</h2>
                <button class="add-btn" id="addObjectBtn">+ A√±adir Objeto</button>
            </div>
            
            <!-- Filtros -->
            <div class="filters">
                <select id="objectCategoryFilter" class="filter-select">
                    <option value="">Todas las categor√≠as</option>
                    <option value="Herramientas">Herramientas</option>
                    <option value="Consumibles">Consumibles</option>
                    <option value="Estructuras">Estructuras</option>
                    <option value="Componentes">Componentes</option>
                    <option value="Vehiculares">Vehiculares</option>
                    <option value="Otros">Otros</option>
                </select>
                <select id="objectStatusFilter" class="filter-select">
                    <option value="">Todos los estados</option>
                    <option value="can-craft">Puedo crear</option>
                    <option value="missing-materials">Faltan materiales</option>
                </select>
            </div>

            <div id="objectContainer" class="items-container">
                <!-- Items se cargan din√°micamente -->
            </div>
        </section>

        <!-- Pesta√±a Veh√≠culos -->
        <section id="vehicles-tab" class="tab-content">
            <div class="tab-header">
                <h2>üöó Veh√≠culos</h2>
                <button class="add-btn" id="addVehicleBtn">+ A√±adir Veh√≠culo</button>
            </div>
            
            <!-- Filtros -->
            <div class="filters">
                <select id="vehicleCategoryFilter" class="filter-select">
                    <option value="">Todas las categor√≠as</option>
                    <option value="Ornit√≥pteros">Ornit√≥pteros</option>
                    <option value="Moto de arena">Moto de arena</option>
                    <option value="Naves">Naves</option>
                    <option value="M√≥dulos">M√≥dulos</option>
                    <option value="Otros">Otros</option>
                </select>
                <select id="vehicleStatusFilter" class="filter-select">
                    <option value="">Todos los estados</option>
                    <option value="can-craft">Puedo crear</option>
                    <option value="missing-materials">Faltan materiales</option>
                </select>
            </div>

            <div id="vehicleContainer" class="items-container">
                <!-- Items se cargan din√°micamente -->
            </div>
        </section>

        <!-- Pesta√±a Armas -->
        <section id="weapons-tab" class="tab-content">
            <div class="tab-header">
                <h2>‚öîÔ∏è Armas</h2>
                <button class="add-btn" id="addWeaponBtn">+ A√±adir Arma</button>
            </div>
            
            <!-- Filtros -->
            <div class="filters">
                <select id="weaponCategoryFilter" class="filter-select">
                    <option value="">Todas las categor√≠as</option>
                    <option value="Hoja corta">Hoja corta</option>
                    <option value="Hoja larga">Hoja larga</option>
                    <option value="Rifles">Rifles</option>
                    <option value="Pistolas">Pistolas</option>
                    <option value="Explosivos">Explosivos</option>
                    <option value="L√°seres">L√°seres</option>
                    <option value="Armas pesadas">Armas pesadas</option>
                    <option value="Otros">Otros</option>
                </select>
                <select id="weaponStatusFilter" class="filter-select">
                    <option value="">Todos los estados</option>
                    <option value="can-craft">Puedo crear</option>
                    <option value="missing-materials">Faltan materiales</option>
                </select>
            </div>

            <div id="weaponContainer" class="items-container">
                <!-- Items se cargan din√°micamente -->
            </div>
        </section>

       <!-- Pesta√±a Webs -->
<section id="webs-tab" class="tab-content">
    <div class="tab-header">
        <h2>üåê Webs</h2>
        
    </div>

    <div class="items-container">
        <div class="item-card">
            <div class="item-header">
                <img src="https://gtcdn.info/gt/gt.svg" class="item-image" alt="Dune Awakening">
                <div class="item-info">
                    <h3>Dune Awakening</h3>
                    <div class="item-category">Database</div>
                </div>
            </div>
            <div class="item-notes">Accede a informaci√≥n sobre recursos de Dune Awakening.</div>
            <div class="item-actions">
                <a href="https://dune.gaming.tools/" target="_blank" rel="noopener noreferrer" class="utility-btn">üåê Visitar</a>
            </div>
        </div>

        <div class="item-card">
            <div class="item-header">
                <img src="https://duneawakening.wiki.fextralife.com/file/XDune-Awakening/dune-awakening-wiki-logo.png" class="item-image" alt="Dune Awakening">
                <div class="item-info">
                    <h3>Dune Awakening</h3>
                    <div class="item-category">Wiki</div>
                </div>
            </div>
            <div class="item-notes">Accede a informaci√≥n sobre recursos de Dune Awakening.</div>
            <div class="item-actions">
                <a href="https://duneawakening.wiki.fextralife.com/Dune+Awakening+Wiki" target="_blank" rel="noopener noreferrer" class="utility-btn">üåê Visitar</a>
            </div>
        </div>

        
    </div>

    
</section>

<!-- Pesta√±a Mapa -->
<section id="mapa-tab" class="tab-content">
    <div class="tab-header">
        <h2>üó∫Ô∏è Mapa</h2>
        
    </div>

    <div class="items-container">
        <div class="item-card">
            <div class="item-header">
                <img src="https://duneawakening.wiki.fextralife.com/file/XDune-Awakening/dune-awakening-wiki-logo.png" class="item-image" alt="Mapa">
                <div class="item-info">
                    <h3>Mapa Interactivo de Dune</h3>
                    <div class="item-category">Herramienta externa</div>
                </div>
            </div>
            <div class="item-notes">Explora ubicaciones, rutas y puntos de inter√©s en el mundo de Arrakis.</div>
            <div class="item-actions">
                <a href="https://duneawakening.wiki.fextralife.com/Interactive+Map" target="_blank" rel="noopener noreferrer" class="utility-btn">üìç Ver Mapa</a>
            </div>
        </div>
    </div>
</section>



    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>Web creada por <strong>Roberto Dorado Rodr√≠guez</strong> ¬© 2025</p>
        </div>
    </footer>

    <!-- Modal para A√±adir/Editar Recursos -->
    <div id="resourceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="resourceModalTitle">A√±adir Recurso</h3>
                <button class="close-btn">&times;</button>
            </div>
            <form id="resourceForm">
                <div class="form-group">
                    <label for="resourceName">Nombre del Recurso:</label>
                    <input type="text" id="resourceName" required>
                </div>
                <div class="form-group">
                    <label for="resourceCategory">Categor√≠a:</label>
                    <select id="resourceCategory" required>
                        <option value="">Seleccionar categor√≠a</option>
                        <option value="Minerales">Minerales</option>
                        <option value="Metales">Metales</option>
                        <option value="Org√°nicos">Org√°nicos</option>
                        <option value="Combustibles">Combustibles</option>
                        <option value="Lingotes">Lingotes</option>
                        <option value="Componentes">Componentes</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="resourceLevel">Tier:</label>
                    <select id="resourceLevel" required>
                        <option value="0">Tier 0</option>
                        <option value="1">Tier 1</option>
                        <option value="2">Tier 2</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="resourceQuantity">Cantidad:</label>
                    <input type="number" id="resourceQuantity" min="0" value="0" required>
                </div>
                <div class="form-group">
                    <label for="resourceImage">URL de Imagen:</label>
                    <input type="url" id="resourceImage" placeholder="https://ejemplo.com/imagen.jpg">
                </div>
                <div class="form-group">
                    <label for="resourceNotes">Notas (opcional):</label>
                    <textarea id="resourceNotes" rows="3"></textarea>
                </div>
                <div class="form-buttons">
                    <button type="submit" class="submit-btn">Guardar</button>
                    <button type="button" class="cancel-btn">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para A√±adir/Editar Objetos/Veh√≠culos/Armas -->
    <div id="craftingModal" class="modal">
        <div class="modal-content crafting-modal">
            <div class="modal-header">
                <h3 id="craftingModalTitle">A√±adir Objeto</h3>
                <button class="close-btn">&times;</button>
            </div>
            <form id="craftingForm">
                <div class="form-group">
                    <label for="craftingName">Nombre:</label>
                    <input type="text" id="craftingName" required>
                </div>
                <div class="form-group">
                    <label for="craftingCategory">Categor√≠a:</label>
                    <select id="craftingCategory" required>
                        <option value="">Seleccionar categor√≠a</option>
                        <!-- Las opciones se llenan din√°micamente seg√∫n el tipo -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="craftingImage">URL de Imagen:</label>
                    <input type="url" id="craftingImage" placeholder="https://ejemplo.com/imagen.jpg">
                </div>
                <div class="form-group">
                    <label for="craftingTool">Herramienta Necesaria:</label>
                    <select id="craftingTool">
                        <option value="">Ninguna</option>
                        <option value="Fabricator">Fabricator</option>
                        <option value="Workbench">Workbench</option>
                        <option value="Refinery">Refinery</option>
                        <option value="Constructor">Constructor</option>
                        <option value="Advanced Fabricator">Advanced Fabricator</option>
                        <option value="Vehicle Assembly">Vehicle Assembly</option>
                        <option value="Weapon Forge">Weapon Forge</option>
                        <option value="Other">Otra</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="craftingTime">Tiempo (segundos):</label>
                        <input type="number" id="craftingTime" min="0" value="1">
                    </div>
                    <div class="form-group">
                        <label for="craftingYield">Produce (cantidad):</label>
                        <input type="number" id="craftingYield" min="1" value="1">
                    </div>
                </div>
                
                <!-- Receta (Materiales) -->
                <div class="form-group">
                    <label>Materiales Necesarios:</label>
                    <div id="recipeContainer">
                        <!-- Materiales se a√±aden din√°micamente -->
                    </div>
                    <button type="button" id="addMaterialBtn" class="add-material-btn">+ A√±adir Material</button>
                </div>
                
                <div class="form-group">
                    <label for="craftingNotes">Notas (opcional):</label>
                    <textarea id="craftingNotes" rows="3"></textarea>
                </div>
                <div class="form-buttons">
                    <button type="submit" class="submit-btn">Guardar</button>
                    <button type="button" class="cancel-btn">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Calculadora -->
    <div id="calculatorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Calculadora de Creaci√≥n</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="calculator-content">
                <div class="form-group">
                    <label for="calcItem">Objeto a crear:</label>
                    <select id="calcItem">
                        <option value="">Seleccionar objeto</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="calcQuantity">Cantidad deseada:</label>
                    <input type="number" id="calcQuantity" min="1" value="1">
                </div>
                <button id="calculateBtn" class="submit-btn">Calcular</button>
                <div id="calculatorResults" class="calculator-results">
                    <!-- Resultados aparecen aqu√≠ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Objetivos -->
    <div id="objectivesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Lista de Objetivos</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="objectives-content">
                <div class="form-group">
                    <input type="text" id="newObjective" placeholder="A√±adir nuevo objetivo...">
                    <button id="addObjectiveBtn" class="add-btn" style="margin-top: 0.75rem;">A√±adir</button>

                </div>
                <div id="objectivesList" class="objectives-list">
                    <!-- Objetivos aparecen aqu√≠ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let rawResources = [];
        let refinedResources = [];
        let objects = [];
        let vehicles = [];
        let weapons = [];
        let objectives = [];
        let editingItem = null;
        let editingType = null;
        let changeCount = 0;

        // Categor√≠as por tipo
        const categoryOptions = {
            objects: [
                'Herramientas',
                'Consumibles', 
                'Estructuras',
                'Componentes',
                'Vehiculares',
                'Otros'
            ],
            vehicles: [
                'Ornit√≥pteros',
                'Moto de arena',
                'Naves',
                'M√≥dulos',
                'Otros'
            ],
            weapons: [
                'Hoja corta',
                'Hoja larga',
                'Rifles',
                'Pistolas',
                'Explosivos',
                'L√°seres',
                'Armas pesadas',
                'Otros'
            ]
        };

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadDataFromStorage();
            setupEventListeners();
            renderAllTabs();
            populateCalculatorDropdown();
            renderObjectives();
            renderDashboard();
        }

        // Gesti√≥n de almacenamiento
        function loadDataFromStorage() {
            try {
                rawResources = JSON.parse(localStorage.getItem('duneRawResources')) || [];
                refinedResources = JSON.parse(localStorage.getItem('duneRefinedResources')) || [];
                
                // Migrar datos existentes de craftingItems
                const oldCraftingItems = JSON.parse(localStorage.getItem('duneCraftingItems')) || [];
                
                objects = JSON.parse(localStorage.getItem('duneObjects')) || [];
                vehicles = JSON.parse(localStorage.getItem('duneVehicles')) || [];
                weapons = JSON.parse(localStorage.getItem('duneWeapons')) || [];
                
                // Si no hay datos nuevos pero hay craftingItems, migrar
                if (objects.length === 0 && vehicles.length === 0 && weapons.length === 0 && oldCraftingItems.length > 0) {
                    migrateOldCraftingData(oldCraftingItems);
                }
                
                objectives = JSON.parse(localStorage.getItem('duneObjectives')) || [];
                
                // Asegurar que objetos tengan campo quantity
                [objects, vehicles, weapons].forEach(collection => {
                    collection.forEach(item => {
                        if (item.quantity === undefined) {
                            item.quantity = 0;
                        }
                    });
                });
            } catch (error) {
                console.error('Error loading data:', error);
                resetAllData();
            }
        }

        function migrateOldCraftingData(oldItems) {
            // Distribuir items seg√∫n sus categor√≠as
            oldItems.forEach(item => {
                if (!item.category) return;
                
                if (['Ornit√≥pteros', 'Moto de arena', 'Naves', 'M√≥dulos'].includes(item.category)) {
                    vehicles.push(item);
                } else if (['Hoja corta', 'Hoja larga', 'Rifles', 'Pistolas', 'Explosivos', 'L√°seres', 'Armas pesadas'].includes(item.category)) {
                    weapons.push(item);
                } else {
                    objects.push(item);
                }
            });
            
            // Limpiar datos antiguos
            localStorage.removeItem('duneCraftingItems');
            saveToStorage();
        }

        function saveToStorage() {
            try {
                localStorage.setItem('duneRawResources', JSON.stringify(rawResources));
                localStorage.setItem('duneRefinedResources', JSON.stringify(refinedResources));
                localStorage.setItem('duneObjects', JSON.stringify(objects));
                localStorage.setItem('duneVehicles', JSON.stringify(vehicles));
                localStorage.setItem('duneWeapons', JSON.stringify(weapons));
                localStorage.setItem('duneObjectives', JSON.stringify(objectives));
                
                changeCount++;
                if (changeCount >= 5) {
                    createBackup();
                    changeCount = 0;
                }
                
                updateDashboardIfVisible();
            } catch (error) {
                console.error('Error saving data:', error);
                alert('Error al guardar datos. El almacenamiento local puede estar lleno.');
            }
        }

        function updateDashboardIfVisible() {
            if (document.getElementById('totalItems')) {
                renderDashboard();
            }
        }

        function createBackup() {
            const backup = {
                rawResources,
                refinedResources, 
                objects,
                vehicles,
                weapons,
                objectives,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('duneBackup', JSON.stringify(backup));
        }

        function resetAllData() {
            rawResources = [];
            refinedResources = [];
            objects = [];
            vehicles = [];
            weapons = [];
            objectives = [];
            saveToStorage();
        }

        // Event Listeners
        function setupEventListeners() {
            // Pesta√±as
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => switchTab(btn.dataset.tab));
            });

            // Botones principales
            document.getElementById('addRawBtn').addEventListener('click', () => openResourceModal('raw'));
            document.getElementById('addRefinedBtn').addEventListener('click', () => openResourceModal('refined'));
            document.getElementById('addObjectBtn').addEventListener('click', () => openCraftingModal('objects'));
            document.getElementById('addVehicleBtn').addEventListener('click', () => openCraftingModal('vehicles'));
            document.getElementById('addWeaponBtn').addEventListener('click', () => openCraftingModal('weapons'));

            // Utilidades
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('importBtn').addEventListener('click', () => document.getElementById('importFile').click());
            document.getElementById('importFile').addEventListener('change', importData);
            document.getElementById('calculatorBtn').addEventListener('click', openCalculatorModal);
            document.getElementById('objectivesBtn').addEventListener('click', openObjectivesModal);

            // B√∫squeda
            document.getElementById('globalSearch').addEventListener('input', handleGlobalSearch);
            document.getElementById('clearSearch').addEventListener('click', clearSearch);

            // Filtros
            setupFilterListeners();

            // Modales
            setupModalListeners();
        }

        function setupFilterListeners() {
            document.getElementById('rawCategoryFilter').addEventListener('change', () => renderTab('raw'));
            document.getElementById('rawLevelFilter').addEventListener('change', () => renderTab('raw'));
            document.getElementById('refinedCategoryFilter').addEventListener('change', () => renderTab('refined'));
            document.getElementById('refinedLevelFilter').addEventListener('change', () => renderTab('refined'));
            document.getElementById('objectCategoryFilter').addEventListener('change', () => renderTab('objects'));
            document.getElementById('objectStatusFilter').addEventListener('change', () => renderTab('objects'));
            document.getElementById('vehicleCategoryFilter').addEventListener('change', () => renderTab('vehicles'));
            document.getElementById('vehicleStatusFilter').addEventListener('change', () => renderTab('vehicles'));
            document.getElementById('weaponCategoryFilter').addEventListener('change', () => renderTab('weapons'));
            document.getElementById('weaponStatusFilter').addEventListener('change', () => renderTab('weapons'));
        }

        function setupModalListeners() {
            // Cerrar modales
            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', closeAllModals);
            });

            document.querySelectorAll('.cancel-btn').forEach(btn => {
                btn.addEventListener('click', closeAllModals);
            });

            // Cerrar modal al hacer clic fuera
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) closeAllModals();
                });
            });

            // Formularios
            document.getElementById('resourceForm').addEventListener('submit', handleResourceSubmit);
            document.getElementById('craftingForm').addEventListener('submit', handleCraftingSubmit);

            // Espec√≠ficos de objetos/veh√≠culos/armas
            document.getElementById('addMaterialBtn').addEventListener('click', addMaterialToRecipe);
            
            // Calculadora
            document.getElementById('calculateBtn').addEventListener('click', performCalculation);
            
            // Objetivos
            document.getElementById('addObjectiveBtn').addEventListener('click', addObjective);
            document.getElementById('newObjective').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addObjective();
            });
        }

        // Navegaci√≥n de pesta√±as
        function switchTab(tabName) {
            // Actualizar botones
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Mostrar contenido
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');

            // Renderizar contenido
            renderTab(tabName);
        }

        // Renderizado
        function renderAllTabs() {
            renderTab('raw');
            renderTab('refined');
            renderTab('objects');
            renderTab('vehicles');
            renderTab('weapons');
        }

        function renderDashboard() {
            // Calcular estad√≠sticas generales
            const totalItems = [...rawResources, ...refinedResources, ...objects, ...vehicles, ...weapons]
                .reduce((sum, item) => sum + (item.quantity || 0), 0);
            const totalObjectives = objectives.length;
            const completedObjectives = objectives.filter(obj => obj.completed).length;
            const pendingObjectives = objectives.filter(obj => !obj.completed);
            
            // Calcular items creables
            const craftableCount = [...refinedResources, ...objects, ...vehicles, ...weapons].filter(item => {
                if (!item.recipe || item.recipe.length === 0) return false;
                const status = getCraftingStatus(item);
                return status.canCraft;
            }).length;

            // Actualizar resumen superior
            document.getElementById('totalItems').textContent = totalItems.toLocaleString();
            document.getElementById('totalObjectives').textContent = `${completedObjectives}/${totalObjectives}`;
            document.getElementById('craftableItems').textContent = craftableCount;

            // Renderizar cada secci√≥n
            renderLowResources();
            renderCraftableItems();
            renderPendingObjectives();
            renderCategoryStats();
            renderTopResources();
            renderInventoryStatus();
        }

        function renderLowResources() {
            const container = document.getElementById('lowResourcesContent');
            const allResources = [...rawResources, ...refinedResources];
            const lowResources = allResources.filter(resource => resource.quantity < 10).sort((a, b) => a.quantity - b.quantity);

            if (lowResources.length === 0) {
                container.innerHTML = '<div class="empty-dashboard"><h4>¬°Excelente!</h4><p>No tienes recursos escasos</p></div>';
                return;
            }

            container.innerHTML = lowResources.slice(0, 8).map(resource => `
                <div class="dashboard-item warning-item">
                    <div>
                        <div class="dashboard-item-name">${resource.name}</div>
                        <div class="dashboard-item-category">${resource.category} ‚Ä¢ Tier ${resource.level}</div>
                    </div>
                    <div class="dashboard-item-value">${resource.quantity}</div>
                </div>
            `).join('');
        }

        function renderCraftableItems() {
    const container = document.getElementById('craftableItemsContent');

    const allItems = [...refinedResources, ...objects, ...vehicles, ...weapons];

    console.log("Moto de arena (debug):", vehicles.find(v => v.name.toLowerCase().includes("moto")));
console.log("Status:", getCraftingStatus(vehicles.find(v => v.name.toLowerCase().includes("moto"))));


    const allCraftable = allItems.filter(item => {
        if (!item.recipe || !Array.isArray(item.recipe) || item.recipe.length === 0) return false;
        const status = getCraftingStatus(item);
        return status.canCraft;
    });

    if (allCraftable.length === 0) {
        container.innerHTML = '<div class="empty-dashboard"><h4>Sin materiales</h4><p>Necesitas m√°s recursos para crear</p></div>';
        return;
    }

    container.innerHTML = allCraftable.map(item => {

        const maxCraftable = getMaxCraftable(item);

        // Detecci√≥n robusta del tipo de item
        let itemType = 'Otro';
        if (refinedResources.find(r => r.id === item.id)) itemType = 'Refinado';
        else if (objects.find(o => o.id === item.id)) itemType = 'Objeto';
        else if (vehicles.find(v => v.id === item.id)) itemType = 'Veh√≠culo';
        else if (weapons.find(w => w.id === item.id)) itemType = 'Arma';

        return `
            <div class="dashboard-item success-item">
                <div>
                    <div class="dashboard-item-name">${item.name}</div>
                    <div class="dashboard-item-category">${item.category} (${itemType})</div>
                </div>
                <div class="dashboard-item-value">√ó${maxCraftable}</div>
            </div>
        `;
    }).join('');
}


        function renderPendingObjectives() {
            const container = document.getElementById('pendingObjectivesContent');
            const pending = objectives.filter(obj => !obj.completed);

            if (pending.length === 0) {
                container.innerHTML = '<div class="empty-dashboard"><h4>¬°Todo completado!</h4><p>No tienes objetivos pendientes</p></div>';
                return;
            }

            container.innerHTML = pending.slice(0, 5).map(objective => `
                <div class="objective-preview">
                    <div class="objective-preview-text">${objective.text}</div>
                </div>
            `).join('');
        }

        function renderCategoryStats() {
            const container = document.getElementById('categoryStatsContent');
            const allResources = [...rawResources, ...refinedResources];
            const categories = {};

            // Contar por categor√≠as
            allResources.forEach(resource => {
                if (!categories[resource.category]) {
                    categories[resource.category] = { count: 0, total: 0 };
                }
                categories[resource.category].count++;
                categories[resource.category].total += resource.quantity;
            });

            if (Object.keys(categories).length === 0) {
                container.innerHTML = '<div class="empty-dashboard"><h4>Sin datos</h4><p>A√±ade recursos para ver estad√≠sticas</p></div>';
                return;
            }

            const maxTotal = Math.max(...Object.values(categories).map(cat => cat.total));

            container.innerHTML = Object.entries(categories).map(([name, data]) => {
                const percentage = maxTotal > 0 ? (data.total / maxTotal) * 100 : 0;
                return `
                    <div class="category-stat">
                        <div class="category-name">
                            <span>${name}</span>
                        </div>
                        <div class="category-count">${data.total}</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percentage}%"></div>
                    </div>
                `;
            }).join('');
        }

        function renderTopResources() {
            const container = document.getElementById('topResourcesContent');
            const allResources = [...rawResources, ...refinedResources]
                .filter(resource => resource.quantity > 0)
                .sort((a, b) => b.quantity - a.quantity);

            if (allResources.length === 0) {
                container.innerHTML = '<div class="empty-dashboard"><h4>Inventario vac√≠o</h4><p>A√±ade recursos para ver el ranking</p></div>';
                return;
            }

            container.innerHTML = allResources.slice(0, 5).map((resource, index) => {
                const medal = ['ü•á', 'ü•à', 'ü•â', '4Ô∏è‚É£', '5Ô∏è‚É£'][index];
                return `
                    <div class="dashboard-item info-item">
                        <div>
                            <div class="dashboard-item-name">${medal} ${resource.name}</div>
                            <div class="dashboard-item-category">${resource.category}</div>
                        </div>
                        <div class="dashboard-item-value">${resource.quantity}</div>
                    </div>
                `;
            }).join('');
        }

        function renderInventoryStatus() {
            const container = document.getElementById('inventoryStatusContent');
            
            const totalRaw = rawResources.reduce((sum, item) => sum + item.quantity, 0);
            const totalRefined = refinedResources.reduce((sum, item) => sum + item.quantity, 0);
            const totalObjects = objects.reduce((sum, item) => sum + (item.quantity || 0), 0);
            const totalVehicles = vehicles.reduce((sum, item) => sum + (item.quantity || 0), 0);
            const totalWeapons = weapons.reduce((sum, item) => sum + (item.quantity || 0), 0);
            
            const uniqueRaw = rawResources.length;
            const uniqueRefined = refinedResources.length;
            const uniqueObjects = objects.length;
            const uniqueVehicles = vehicles.length;
            const uniqueWeapons = weapons.length;
            
            const completedObj = objectives.filter(obj => obj.completed).length;
            const totalObj = objectives.length;
            const objPercentage = totalObj > 0 ? Math.round((completedObj / totalObj) * 100) : 0;

            container.innerHTML = `
                <div class="dashboard-item">
                    <div class="dashboard-item-name">Recursos en bruto</div>
                    <div class="dashboard-item-value">${totalRaw} (${uniqueRaw} tipos)</div>
                </div>
                <div class="dashboard-item">
                    <div class="dashboard-item-name">Recursos refinados</div>
                    <div class="dashboard-item-value">${totalRefined} (${uniqueRefined} tipos)</div>
                </div>
                <div class="dashboard-item">
                    <div class="dashboard-item-name">Objetos</div>
                    <div class="dashboard-item-value">${totalObjects} (${uniqueObjects} tipos)</div>
                </div>
                <div class="dashboard-item">
                    <div class="dashboard-item-name">Veh√≠culos</div>
                    <div class="dashboard-item-value">${totalVehicles} (${uniqueVehicles} tipos)</div>
                </div>
                <div class="dashboard-item">
                    <div class="dashboard-item-name">Armas</div>
                    <div class="dashboard-item-value">${totalWeapons} (${uniqueWeapons} tipos)</div>
                </div>
                <div class="dashboard-item">
                    <div class="dashboard-item-name">Progreso Objetivos</div>
                    <div class="dashboard-item-value">${objPercentage}%</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${objPercentage}%"></div>
                </div>
            `;
        }

        function renderTab(tabName) {
            switch(tabName) {
                case 'raw':
                    renderResources(rawResources, 'rawContainer', 'raw');
                    break;
                case 'refined':
                    renderResources(refinedResources, 'refinedContainer', 'refined');
                    break;
                case 'objects':
                    renderCrafting(objects, 'objectContainer', 'objects');
                    break;
                case 'vehicles':
                    renderCrafting(vehicles, 'vehicleContainer', 'vehicles');
                    break;
                case 'weapons':
                    renderCrafting(weapons, 'weaponContainer', 'weapons');
                    break;
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'webs':
    // Puedes poner renderWebs() si haces l√≥gica luego
    break;

            }
        }

        function renderResources(resources, containerId, type) {
            const container = document.getElementById(containerId);
            const filteredResources = filterResources(resources, type);
            
            if (filteredResources.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No hay recursos</h3>
                        <p>A√±ade tu primer recurso usando el bot√≥n correspondiente</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredResources.map(resource => `
                <div class="item-card" data-id="${resource.id}">
                    <div class="item-header">
                        <img src="${resource.image || getDefaultImage('resource')}" 
                             alt="${resource.name}" class="item-image"
                             onerror="this.src='${getDefaultImage('resource')}'">
                        <div class="item-info">
                            <h3>${resource.name}</h3>
                            <div class="item-category">${resource.category}</div>
                        </div>
                        <div class="item-level">Tier ${resource.level}</div>
                    </div>
                    
                    <div class="item-quantity">
                        <span class="quantity-label">Cantidad:</span>
                        <div class="quantity-controls">
                            <button class="quantity-btn" onclick="changeQuantity('${resource.id}', '${type}', -1)">-</button>
                            <span class="quantity-display">${resource.quantity}</span>
                            <button class="quantity-btn" onclick="changeQuantity('${resource.id}', '${type}', 1)">+</button>
                        </div>
                    </div>
                    
                    ${resource.notes ? `<div class="item-notes">${resource.notes}</div>` : ''}
                    
                    <div class="item-actions">
                        <button class="edit-btn" onclick="editResource('${resource.id}', '${type}')" title="Editar">‚úèÔ∏è</button>
                        <button class="delete-btn" onclick="deleteResource('${resource.id}', '${type}')" title="Eliminar">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function renderCrafting(items, containerId, type) {
    const container = document.getElementById(containerId);
    const filteredItems = filterCrafting(items, type);
    
    if (filteredItems.length === 0) {
        const typeName = type === 'objects' ? 'objetos' : type === 'vehicles' ? 'veh√≠culos' : 'armas';
        container.innerHTML = `
            <div class="empty-state">
                <h3>No hay ${typeName}</h3>
                <p>A√±ade tu primer ${typeName.slice(0, -1)} usando el bot√≥n correspondiente</p>
            </div>
        `;
        return;
    }

    container.innerHTML = filteredItems.map(item => {
        const craftingStatus = getCraftingStatus(item);
        const maxCraftable = getMaxCraftable(item);

        const statusHTML = `
            <span class="crafting-status ${craftingStatus.canCraft ? 'can-craft' : 'missing-materials'}">
                ${craftingStatus.canCraft ? `Puedo hacer ${maxCraftable}` : 'Faltan materiales'}
            </span>
        `;
        
        return `
            <div class="item-card crafting-card" data-id="${item.id}">
                <div class="item-header">
                    <img src="${item.image || getDefaultImage(type)}" 
                         alt="${item.name}" class="item-image"
                         onerror="this.src='${getDefaultImage(type)}'">
                    <div class="item-info">
                        <h3>${item.name}</h3>
                        <div class="item-category">${item.category}</div>
                    </div>
                </div>
                
                <div class="item-quantity">
                    <span class="quantity-label">Tengo:</span>
                    <div class="quantity-controls">
                        <button class="quantity-btn" onclick="changeQuantity('${item.id}', '${type}', -1)">-</button>
                        <span class="quantity-display">${item.quantity || 0}</span>
                        <button class="quantity-btn" onclick="changeQuantity('${item.id}', '${type}', 1)">+</button>
                    </div>
                </div>
                
                <div class="recipe-info">
                    <div class="recipe-title">Materiales necesarios:</div>
                    <div class="recipe-materials">
                        ${item.recipe.map(material => {
                            const available = findMaterialQuantity(material.name);
                            const sufficient = available >= material.quantity;
                            return `
                                <div class="material-item">
                                    <span class="material-name">${material.name} x${material.quantity}</span>
                                    <span class="${sufficient ? 'material-available' : 'material-missing'}">
                                        (${available}/${material.quantity})
                                    </span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
                
                <div class="craft-info">
                    <div>üîß ${item.tool || 'Manual'}</div>
                    <div>‚è±Ô∏è ${item.time}s</div>
                    <div>üì¶ Produce ${item.yield}</div>
                </div>
                
                ${item.notes ? `<div class="item-notes">${item.notes}</div>` : ''}

                <div class="item-actions">
                    ${statusHTML}
                    <button class="edit-btn" onclick="editCrafting('${item.id}', '${type}')" title="Editar">‚úèÔ∏è</button>
                    <button class="delete-btn" onclick="deleteCrafting('${item.id}', '${type}')" title="Eliminar">üóëÔ∏è</button>
                </div>
            </div>
        `;
    }).join('');
}


        // Im√°genes por defecto
        function getDefaultImage(type) {
            const images = {
                resource: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjNEE1NTY4Ii8+CjxwYXRoIGQ9Ik0zMCAyMEM0NCAyNyA0NCAzMyAzMCA0MEMxNiAzMyAxNiAyNyAzMCAyMFoiIGZpbGw9IiNGRkE3MjYiLz4KPHN2Zz4K',
                objects: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjNEE1NTY4Ii8+CjxwYXRoIGQ9Ik0yMCAyMEg0MFY0MEgyMFYyMFpNMjUgMjVWMzVIMzVWMjVIMjVaIiBmaWxsPSIjRkZBNzI2Ii8+PC9zdmc+',
                vehicles: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjNEE1NTY4Ii8+CjxwYXRoIGQ9Ik0xNSAzNUg0NUwyMCAyNUw0MCAyNVoiIGZpbGw9IiNGRkE3MjYiLz4KPGNpcmNsZSBjeD0iMjUiIGN5PSIzNSIgcj0iNCIgZmlsbD0iI0ZGQTcyNiIvPgo8Y2lyY2xlIGN4PSIzNSIgY3k9IjM1IiByPSI0IiBmaWxsPSIjRkZBNzI2Ii8+PC9zdmc+',
                weapons: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjNEE1NTY4Ii8+CjxwYXRoIGQ9Ik0yMCA0MEwyNSAyMEwzNSAyMEw0MCA0MEgzNUgzMEgyNUgyMFoiIGZpbGw9IiNGRkE3MjYiLz4KPHJlY3QgeD0iMjciIHk9IjQwIiB3aWR0aD0iNiIgaGVpZ2h0PSIxMCIgZmlsbD0iI0ZGQTcyNiIvPjwvc3ZnPg=='
            };
            return images[type] || images.resource;
        }

        // Filtros
        function filterResources(resources, type) {
            const categoryFilter = document.getElementById(`${type}CategoryFilter`).value;
            const levelFilter = document.getElementById(`${type}LevelFilter`).value;
            const searchTerm = document.getElementById('globalSearch').value.toLowerCase();
            
            return resources.filter(resource => {
                const matchesCategory = !categoryFilter || resource.category === categoryFilter;
                const matchesLevel = !levelFilter || resource.level.toString() === levelFilter;
                const matchesSearch = !searchTerm || 
                    resource.name.toLowerCase().includes(searchTerm) ||
                    resource.category.toLowerCase().includes(searchTerm) ||
                    (resource.notes && resource.notes.toLowerCase().includes(searchTerm));
                
                return matchesCategory && matchesLevel && matchesSearch;
            });
        }

        function filterCrafting(items, type) {
    const categoryEl = document.getElementById(`${type}CategoryFilter`);
    const statusEl = document.getElementById(`${type}StatusFilter`);
    const categoryFilter = categoryEl ? categoryEl.value : "";
    const statusFilter = statusEl ? statusEl.value : "";
    const searchTerm = document.getElementById('globalSearch').value.toLowerCase();

    return items.filter(item => {
        const matchesCategory = !categoryFilter || item.category === categoryFilter;
        const matchesSearch = !searchTerm || 
            item.name.toLowerCase().includes(searchTerm) ||
            item.category.toLowerCase().includes(searchTerm) ||
            (item.notes && item.notes.toLowerCase().includes(searchTerm));

        let matchesStatus = true;
        if (statusFilter) {
            const status = getCraftingStatus(item);
            matchesStatus = (statusFilter === 'can-craft' && status.canCraft) ||
                            (statusFilter === 'missing-materials' && !status.canCraft);
        }

        return matchesCategory && matchesSearch && matchesStatus;
    });
}


        // B√∫squeda
        function handleGlobalSearch() {
            renderAllTabs();
        }

        function clearSearch() {
            document.getElementById('globalSearch').value = '';
            renderAllTabs();
        }

        // Gesti√≥n de cantidades
        function changeQuantity(id, type, change) {
            let item;
            let collection;
            
            switch(type) {
                case 'raw':
                    collection = rawResources;
                    break;
                case 'refined':
                    collection = refinedResources;
                    break;
                case 'objects':
                    collection = objects;
                    break;
                case 'vehicles':
                    collection = vehicles;
                    break;
                case 'weapons':
                    collection = weapons;
                    break;
            }
            
            item = collection.find(i => i.id === id);
            
            if (item) {
                item.quantity = Math.max(0, (item.quantity || 0) + change);
                saveToStorage();
                renderTab(type);
                // Actualizar estado de creaci√≥n en todas las pesta√±as que lo necesiten
                if (['raw', 'refined'].includes(type)) {
                    renderTab('objects');
                    renderTab('vehicles');
                    renderTab('weapons');
                }
            }
        }

        // Modales
        function openResourceModal(type) {
            editingType = type;
            editingItem = null;
            
            document.getElementById('resourceModalTitle').textContent = 'A√±adir Recurso';
            document.getElementById('resourceForm').reset();
            document.getElementById('resourceModal').classList.add('show');
        }

        function openCraftingModal(type) {
            editingType = type;
            editingItem = null;
            
            const titles = {
                objects: 'A√±adir Objeto',
                vehicles: 'A√±adir Veh√≠culo', 
                weapons: 'A√±adir Arma'
            };
            
            document.getElementById('craftingModalTitle').textContent = titles[type];
            document.getElementById('craftingForm').reset();
            document.getElementById('recipeContainer').innerHTML = '';
            
            // Actualizar opciones de categor√≠a
            updateCategoryOptions(type);
            
            document.getElementById('craftingModal').classList.add('show');
        }

        function updateCategoryOptions(type) {
            const categorySelect = document.getElementById('craftingCategory');
            categorySelect.innerHTML = '<option value="">Seleccionar categor√≠a</option>';
            
            if (categoryOptions[type]) {
                categoryOptions[type].forEach(category => {
                    categorySelect.innerHTML += `<option value="${category}">${category}</option>`;
                });
            }
        }

        function openCalculatorModal() {
            populateCalculatorDropdown();
            document.getElementById('calculatorModal').classList.add('show');
        }

        function openObjectivesModal() {
            renderObjectives();
            document.getElementById('objectivesModal').classList.add('show');
        }

        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('show');
            });
            editingItem = null;
            editingType = null;
        }

        // Edici√≥n
        function editResource(id, type) {
            const resources = type === 'raw' ? rawResources : refinedResources;
            const resource = resources.find(r => r.id === id);
            
            if (resource) {
                editingItem = resource;
                editingType = type;
                
                document.getElementById('resourceModalTitle').textContent = 'Editar Recurso';
                document.getElementById('resourceName').value = resource.name;
                document.getElementById('resourceCategory').value = resource.category;
                document.getElementById('resourceLevel').value = resource.level;
                document.getElementById('resourceQuantity').value = resource.quantity;
                document.getElementById('resourceImage').value = resource.image || '';
                document.getElementById('resourceNotes').value = resource.notes || '';
                
                document.getElementById('resourceModal').classList.add('show');
            }
        }

        function editCrafting(id, type) {
            let collection;
            switch(type) {
                case 'objects':
                    collection = objects;
                    break;
                case 'vehicles':
                    collection = vehicles;
                    break;
                case 'weapons':
                    collection = weapons;
                    break;
            }
            
            const item = collection.find(i => i.id === id);
            
            if (item) {
                editingItem = item;
                editingType = type;
                
                const titles = {
                    objects: 'Editar Objeto',
                    vehicles: 'Editar Veh√≠culo',
                    weapons: 'Editar Arma'
                };
                
                document.getElementById('craftingModalTitle').textContent = titles[type];
                updateCategoryOptions(type);
                
                document.getElementById('craftingName').value = item.name;
                document.getElementById('craftingCategory').value = item.category;
                document.getElementById('craftingImage').value = item.image || '';
                document.getElementById('craftingTool').value = item.tool || '';
                document.getElementById('craftingTime').value = item.time;
                document.getElementById('craftingYield').value = item.yield;
                document.getElementById('craftingNotes').value = item.notes || '';
                
                // Cargar receta
                const recipeContainer = document.getElementById('recipeContainer');
                recipeContainer.innerHTML = '';
                item.recipe.forEach(material => {
                    addMaterialToRecipe(material.name, material.quantity);
                });
                
                document.getElementById('craftingModal').classList.add('show');
            }
        }

        // Eliminaci√≥n
        function deleteResource(id, type) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este recurso?')) {
                if (type === 'raw') {
                    rawResources = rawResources.filter(r => r.id !== id);
                } else {
                    refinedResources = refinedResources.filter(r => r.id !== id);
                }
                saveToStorage();
                renderTab(type);
                renderTab('objects');
                renderTab('vehicles');
                renderTab('weapons');
            }
        }

        function deleteCrafting(id, type) {
            const typeNames = {
                objects: 'objeto',
                vehicles: 'veh√≠culo',
                weapons: 'arma'
            };
            
            if (confirm(`¬øEst√°s seguro de que quieres eliminar este ${typeNames[type]}?`)) {
                switch(type) {
                    case 'objects':
                        objects = objects.filter(i => i.id !== id);
                        break;
                    case 'vehicles':
                        vehicles = vehicles.filter(i => i.id !== id);
                        break;
                    case 'weapons':
                        weapons = weapons.filter(i => i.id !== id);
                        break;
                }
                saveToStorage();
                renderTab(type);
                populateCalculatorDropdown();
            }
        }

        // Formularios
        function handleResourceSubmit(e) {
    e.preventDefault();

    const type = editingType;
    const resources = type === 'raw' ? rawResources : refinedResources;

    const formData = {
        name: document.getElementById('resourceName').value.trim(),
        category: document.getElementById('resourceCategory').value,
        level: parseInt(document.getElementById('resourceLevel').value),
        quantity: parseInt(document.getElementById('resourceQuantity').value),
        image: document.getElementById('resourceImage').value.trim(),
        notes: document.getElementById('resourceNotes').value.trim()
    };

    if (
        !type || !["raw", "refined"].includes(type) ||
        !formData.name || formData.name === "undefined" ||
        !formData.category || formData.category === "undefined" ||
        isNaN(formData.level) ||
        isNaN(formData.quantity)
    ) {
        alert("Por favor, completa correctamente todos los campos obligatorios.");
        return;
    }

    if (!editingItem && resources.some(r => r.name.toLowerCase() === formData.name.toLowerCase())) {
        alert('Ya existe un recurso con ese nombre.');
        return;
    }

    if (editingItem) {
        Object.assign(editingItem, formData);
    } else {
        formData.id = generateId();
        resources.push(formData);
    }

    saveToStorage();
    renderTab(editingType);
    renderTab('objects');
    renderTab('vehicles');
    renderTab('weapons');
    closeAllModals();
}


        function handleCraftingSubmit(e) {
            e.preventDefault();
            
            const recipe = [];
            document.querySelectorAll('.recipe-item').forEach(item => {
                const materialSelect = item.querySelector('select');
                const quantityInput = item.querySelector('input');
                
                if (materialSelect.value && quantityInput.value > 0) {
                    recipe.push({
                        name: materialSelect.value,
                        quantity: parseInt(quantityInput.value)
                    });
                }
            });
            
            const formData = {
                name: document.getElementById('craftingName').value.trim(),
                category: document.getElementById('craftingCategory').value,
                image: document.getElementById('craftingImage').value.trim(),
                tool: document.getElementById('craftingTool').value,
                time: parseInt(document.getElementById('craftingTime').value),
                yield: parseInt(document.getElementById('craftingYield').value),
                recipe: recipe,
                notes: document.getElementById('craftingNotes').value.trim()
            };
            
            // Validaci√≥n
            if (!formData.name || !formData.category) {
                alert('Por favor, completa todos los campos obligatorios.');
                return;
            }
            
            if (recipe.length === 0) {
                alert('Debes a√±adir al menos un material a la receta.');
                return;
            }
            
            let collection;
            switch(editingType) {
                case 'objects':
                    collection = objects;
                    break;
                case 'vehicles':
                    collection = vehicles;
                    break;
                case 'weapons':
                    collection = weapons;
                    break;
            }
            
            // Verificar duplicados
            if (!editingItem && collection.some(i => i.name.toLowerCase() === formData.name.toLowerCase())) {
                alert('Ya existe un elemento con ese nombre.');
                return;
            }
            
            if (editingItem) {
                // Editar
                Object.assign(editingItem, formData);
                if (editingItem.quantity === undefined) {
                    editingItem.quantity = 0;
                }
            } else {
                // Crear nuevo
                formData.id = generateId();
                formData.quantity = 0;
                collection.push(formData);
            }
            
            saveToStorage();
            renderTab(editingType);
            populateCalculatorDropdown();
            closeAllModals();
        }

        // Gesti√≥n de recetas
        function addMaterialToRecipe(materialName = '', quantity = 1) {
            const recipeContainer = document.getElementById('recipeContainer');
            const allMaterials = [...rawResources, ...refinedResources, ...objects];

            
            const recipeItem = document.createElement('div');
            recipeItem.className = 'recipe-item';
            recipeItem.innerHTML = `
                <select required>
                    <option value="">Seleccionar material</option>
                    ${allMaterials.map(material => 
                        `<option value="${material.name}" ${material.name === materialName ? 'selected' : ''}>${material.name}</option>`
                    ).join('')}
                </select>
                <input type="number" min="1" value="${quantity}" placeholder="Cantidad" required>
                <button type="button" class="remove-material" onclick="this.parentElement.remove()">Eliminar</button>
            `;
            
            recipeContainer.appendChild(recipeItem);
        }

        // L√≥gica de creaci√≥n
        function getCraftingStatus(item) {
            const materialsStatus = item.recipe.map(material => {
                const available = findMaterialQuantity(material.name);
                return {
                    name: material.name,
                    needed: material.quantity,
                    available: available,
                    sufficient: available >= material.quantity
                };
            });
            
            const canCraft = materialsStatus.every(m => m.sufficient);
            
            return {
                canCraft,
                materials: materialsStatus
            };
        }

        function getMaxCraftable(item) {
            let maxCraftable = Infinity;
            
            item.recipe.forEach(material => {
                const available = findMaterialQuantity(material.name);
                const possibleFromThis = Math.floor(available / material.quantity);
                maxCraftable = Math.min(maxCraftable, possibleFromThis);
            });
            
            return maxCraftable === Infinity ? 0 : maxCraftable * item.yield;
        }

        function findMaterialQuantity(materialName) {
    const rawMaterial = rawResources.find(r => r.name === materialName);
    if (rawMaterial) return rawMaterial.quantity;
    
    const refinedMaterial = refinedResources.find(r => r.name === materialName);
    if (refinedMaterial) return refinedMaterial.quantity;

    const objectMaterial = objects.find(r => r.name === materialName);
    if (objectMaterial) return objectMaterial.quantity;
    
    return 0;
}


        // Calculadora
        function populateCalculatorDropdown() {
            const dropdown = document.getElementById('calcItem');
            dropdown.innerHTML = '<option value="">Seleccionar objeto</option>';
            
            const allCraftable = [...objects, ...vehicles, ...weapons];
            allCraftable.forEach(item => {
                let typeLabel = '';
                if (objects.includes(item)) typeLabel = ' (Objeto)';
                else if (vehicles.includes(item)) typeLabel = ' (Veh√≠culo)';
                else if (weapons.includes(item)) typeLabel = ' (Arma)';
                
                dropdown.innerHTML += `<option value="${item.id}" data-type="${getItemType(item)}">${item.name}${typeLabel}</option>`;
            });
        }

        function getItemType(item) {
            if (objects.includes(item)) return 'objects';
            if (vehicles.includes(item)) return 'vehicles';
            if (weapons.includes(item)) return 'weapons';
            return 'unknown';
        }

        function performCalculation() {
            const itemId = document.getElementById('calcItem').value;
            const quantity = parseInt(document.getElementById('calcQuantity').value);
            
            if (!itemId || !quantity) {
                alert('Por favor, selecciona un objeto y cantidad.');
                return;
            }
            
            const allItems = [...objects, ...vehicles, ...weapons];
            const item = allItems.find(i => i.id === itemId);
            if (!item) return;
            
            const craftingBatches = Math.ceil(quantity / item.yield);
            const materialsNeeded = {};
            
            item.recipe.forEach(material => {
                materialsNeeded[material.name] = material.quantity * craftingBatches;
            });
            
            const resultsContainer = document.getElementById('calculatorResults');
            resultsContainer.innerHTML = `
                <h4>Para hacer ${quantity} ${item.name} necesitas:</h4>
                <div class="materials-needed">
                    ${Object.entries(materialsNeeded).map(([name, needed]) => {
                        const available = findMaterialQuantity(name);
                        const sufficient = available >= needed;
                        return `
                            <div class="needed-item ${sufficient ? 'needed-sufficient' : 'needed-insufficient'}">
                                <span>${name}</span>
                                <span style="color: ${sufficient ? '#48bb78' : '#f56565'}">
                                    ${needed} necesarios (tienes ${available})
                                </span>
                            </div>
                        `;
                    }).join('')}
                </div>
                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #4a5568; color: #a0aec0;">
                    Necesitar√°s hacer ${craftingBatches} lotes de creaci√≥n
                </div>
            `;
        }

        // Objetivos
        function addObjective() {
            const input = document.getElementById('newObjective');
            const text = input.value.trim();
            
            if (text) {
                const objective = {
                    id: generateId(),
                    text: text,
                    completed: false,
                    createdAt: new Date().toISOString()
                };
                
                objectives.push(objective);
                saveToStorage();
                renderObjectives();
                input.value = '';
            }
        }

        function renderObjectives() {
            const container = document.getElementById('objectivesList');
            
            if (objectives.length === 0) {
                container.innerHTML = '<div class="empty-state">No tienes objetivos. ¬°A√±ade tu primer objetivo!</div>';
                return;
            }
            
            container.innerHTML = objectives.map(objective => `
                <div class="objective-item ${objective.completed ? 'completed' : ''}">
                    <div class="objective-text">${objective.text}</div>
                    <div class="objective-actions">
                        ${!objective.completed ? `<button class="complete-btn" onclick="completeObjective('${objective.id}')">Completar</button>` : ''}
                        <button class="delete-btn" onclick="deleteObjective('${objective.id}')" title="Eliminar">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function completeObjective(id) {
            const objective = objectives.find(o => o.id === id);
            if (objective) {
                objective.completed = true;
                objective.completedAt = new Date().toISOString();
                saveToStorage();
                renderObjectives();
            }
        }

        function deleteObjective(id) {
            if (confirm('¬øEliminar este objetivo?')) {
                objectives = objectives.filter(o => o.id !== id);
                saveToStorage();
                renderObjectives();
            }
        }

        // Exportar/Importar
        function exportData() {
            const data = {
                rawResources,
                refinedResources,
                objects,
                vehicles,
                weapons,
                objectives,
                exportDate: new Date().toISOString(),
                version: '2.0'
            };
            
            // Crear archivo CSV
            const csvContent = generateCSV(data);
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `dune-inventory-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Tambi√©n exportar JSON
            const jsonBlob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const jsonLink = document.createElement('a');
            const jsonUrl = URL.createObjectURL(jsonBlob);
            jsonLink.setAttribute('href', jsonUrl);
            jsonLink.setAttribute('download', `dune-inventory-${new Date().toISOString().split('T')[0]}.json`);
            jsonLink.style.visibility = 'hidden';
            document.body.appendChild(jsonLink);
            jsonLink.click();
            document.body.removeChild(jsonLink);
        }

        function generateCSV(data) {
            let csv = 'DUNE AWAKENING - INVENTARIO\n\n';
            
            // Recursos Raw
            csv += 'RECURSOS EN BRUTO\n';
            csv += 'Nombre,Categor√≠a,Nivel,Cantidad,Notas\n';
            data.rawResources.forEach(resource => {
                csv += `"${resource.name}","${resource.category}",${resource.level},${resource.quantity},"${resource.notes || ''}"\n`;
            });
            
            csv += '\nRECURSOS REFINADOS\n';
            csv += 'Nombre,Categor√≠a,Nivel,Cantidad,Notas\n';
            data.refinedResources.forEach(resource => {
                csv += `"${resource.name}","${resource.category}",${resource.level},${resource.quantity},"${resource.notes || ''}"\n`;
            });
            
            csv += '\nOBJETOS\n';
            csv += 'Nombre,Categor√≠a,Herramienta,Tiempo,Produce,Materiales,Notas\n';
            data.objects.forEach(item => {
                const materials = item.recipe.map(m => `${m.name} x${m.quantity}`).join('; ');
                csv += `"${item.name}","${item.category}","${item.tool || ''}",${item.time},${item.yield},"${materials}","${item.notes || ''}"\n`;
            });

            csv += '\nVEH√çCULOS\n';
            csv += 'Nombre,Categor√≠a,Herramienta,Tiempo,Produce,Materiales,Notas\n';
            data.vehicles.forEach(item => {
                const materials = item.recipe.map(m => `${m.name} x${m.quantity}`).join('; ');
                csv += `"${item.name}","${item.category}","${item.tool || ''}",${item.time},${item.yield},"${materials}","${item.notes || ''}"\n`;
            });

            csv += '\nARMAS\n';
            csv += 'Nombre,Categor√≠a,Herramienta,Tiempo,Produce,Materiales,Notas\n';
            data.weapons.forEach(item => {
                const materials = item.recipe.map(m => `${m.name} x${m.quantity}`).join('; ');
                csv += `"${item.name}","${item.category}","${item.tool || ''}",${item.time},${item.yield},"${materials}","${item.notes || ''}"\n`;
            });
            
            csv += '\nOBJETIVOS\n';
            csv += 'Objetivo,Estado,Fecha Creaci√≥n,Fecha Completado\n';
            data.objectives.forEach(objective => {
                csv += `"${objective.text}","${objective.completed ? 'Completado' : 'Pendiente'}","${objective.createdAt}","${objective.completedAt || ''}"\n`;
            });
            
            return csv;
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('¬øImportar datos? Esto sobrescribir√° todos los datos actuales.')) {
                        rawResources = data.rawResources || [];
                        refinedResources = data.refinedResources || [];
                        objects = data.objects || [];
                        vehicles = data.vehicles || [];
                        weapons = data.weapons || [];
                        objectives = data.objectives || [];
                        
                        // Migrar datos antiguos si es necesario
                        if (data.craftingItems && data.craftingItems.length > 0) {
                            migrateOldCraftingData(data.craftingItems);
                        }
                        
                        // Asegurar que objetos tengan quantity
                        [objects, vehicles, weapons].forEach(collection => {
                            collection.forEach(item => {
                                if (item.quantity === undefined) {
                                    item.quantity = 0;
                                }
                            });
                        });
                        
                        saveToStorage();
                        renderAllTabs();
                        populateCalculatorDropdown();
                        renderObjectives();
                        
                        alert('Datos importados correctamente.');
                    }
                } catch (error) {
                    alert('Error al importar el archivo. Aseg√∫rate de que sea un archivo JSON v√°lido.');
                }
            };
            reader.readAsText(file);
        }

        // Utilidades
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Funciones globales para onclick
        window.changeQuantity = changeQuantity;
        window.editResource = editResource;
        window.editCrafting = editCrafting;
        window.deleteResource = deleteResource;
        window.deleteCrafting = deleteCrafting;
        window.completeObjective = completeObjective;
        window.deleteObjective = deleteObjective;
    </script>

    <!-- Firebase core -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

<script>
  // Configuraci√≥n de Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyAs3ZeDo6g_SwaiGbruER2444rWkafQLTU",
    authDomain: "dune-inventario.firebaseapp.com",
    projectId: "dune-inventario",
    storageBucket: "dune-inventario.firebasestorage.app",
    messagingSenderId: "26414027507",
    appId: "1:26414027507:web:b8970fb32a837d7117dd86"
  };

  // Inicializar Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  // Referencias a botones
  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const userNameSpan = document.getElementById("userName");

  // Iniciar sesi√≥n con Google
  loginBtn.addEventListener("click", () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).catch(console.error);
  });

  // Cerrar sesi√≥n
  logoutBtn.addEventListener("click", () => {
    auth.signOut().catch(console.error);
  });

  // Detectar cambios en sesi√≥n
  auth.onAuthStateChanged(user => {
    if (user) {
      loginBtn.style.display = "none";
      logoutBtn.style.display = "inline-block";
      userNameSpan.textContent = `üë§ ${user.displayName}`;
    } else {
      loginBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";
      userNameSpan.textContent = "";
    }
  });
</script>

</body>
</html>